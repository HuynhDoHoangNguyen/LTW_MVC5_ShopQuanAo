@model WebsiteShopQuanAo.Models.SAN_PHAM

@{
    ViewBag.Title = "Chỉnh sửa sản phẩm";
}

@section Styles {
    <link href="@Url.Content("~/Areas/Admin/Boot/css/admin-forms-complete.css")" rel="stylesheet" />
}

<div class="create-page-body">
    <div class="create-container">
        <div class="create-header">
            <div class="create-title-section">
                <h1 class="create-main-title">
                    <i class="fas fa-edit"></i>
                    Chỉnh sửa sản phẩm
                </h1>
                <p class="create-subtitle">Cập nhật thông tin chi tiết cho mã: <strong>@Model.MASP</strong></p>
                @* Cập nhật điều hướng về StatusShop *@
                <a href="@Url.Action("StatusShop")" class="back-to-list-btn">
                    <i class="fas fa-arrow-left"></i> Quay lại danh sách
                </a>
            </div>
        </div>

        <div class="form-card-create">
            <div class="card-header-create">
                <h4><i class="fas fa-pencil-alt"></i> Chỉnh sửa thông tin</h4>
            </div>
            <div class="card-body-create">
                @* QUAN TRỌNG: Thêm enctype để upload ảnh mới *@
                @using (Html.BeginForm("Edit", "Admin", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(model => model.MASP)

                    @Html.ValidationSummary(true, "", new { @class = "validation-summary-create" })

                    <div class="form-horizontal-create">
                        <div class="row">
                            <div class="col-md-4 text-center border-end">
                                <label class="control-label-create"><i class="fas fa-image"></i> Hình ảnh hiện tại</label>
                                <div class="image-preview-wrapper mb-3">
                                    @if (Model.HINH_ANH_SP != null && Model.HINH_ANH_SP.Any())
                                    {
                                        var hinh = Model.HINH_ANH_SP.FirstOrDefault();
                                        <img id="imgPreview" src="@Url.Content("~/UI_User/assets/img/product/small-product/"+@hinh.TENHINHANH)" class="img-fluid rounded shadow-sm" style="max-height: 250px;" />
                                    }
                                    else
                                    {
                                        <img id="imgPreview" src="~/Content/Images/no-image.png" class="img-fluid rounded shadow-sm" style="max-height: 250px;" />
                                    }
                                </div>
                                <div class="form-group-create">
                                    <label class="btn btn-outline-primary btn-sm w-100">
                                        <i class="fas fa-upload"></i> Thay đổi ảnh mới
                                        <input type="file" name="imageFile" id="imageFile" hidden accept="image/*" />
                                    </label>
                                    <div class="form-hint mt-2">Để trống nếu giữ nguyên ảnh cũ</div>
                                </div>
                            </div>

                            <div class="col-md-8">
                                <div class="form-group-create">
                                    @Html.LabelFor(model => model.TENSP, "Tên sản phẩm", htmlAttributes: new { @class = "control-label-create required" })
                                    <div class="form-input-create">
                                        @Html.EditorFor(model => model.TENSP, new { htmlAttributes = new { @class = "form-control-create", placeholder = "Nhập tên sản phẩm" } })
                                        @Html.ValidationMessageFor(model => model.TENSP, "", new { @class = "text-danger-create" })
                                    </div>
                                </div>

                                <div class="form-group-create">
                                    @Html.LabelFor(model => model.MADM, "Danh mục", htmlAttributes: new { @class = "control-label-create required" })
                                    <div class="form-input-create">
                                        @Html.DropDownList("MADM", null, htmlAttributes: new { @class = "form-control-create" })
                                        @Html.ValidationMessageFor(model => model.MADM, "", new { @class = "text-danger-create" })
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group-create">
                                            @Html.LabelFor(model => model.SOLUONGTON, "Số lượng tồn", htmlAttributes: new { @class = "control-label-create required" })
                                            <div class="form-input-create">
                                                @Html.EditorFor(model => model.SOLUONGTON, new { htmlAttributes = new { @class = "form-control-create", type = "number", min = "0" } })
                                                @Html.ValidationMessageFor(model => model.SOLUONGTON, "", new { @class = "text-danger-create" })
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group-create">
                                            @Html.LabelFor(model => model.TRANGTHAI, "Trạng thái", htmlAttributes: new { @class = "control-label-create" })
                                            <div class="form-input-create">
                                                <div class="checkbox-create pt-2">
                                                    @Html.EditorFor(model => model.TRANGTHAI)
                                                    <label for="TRANGTHAI">Đang hoạt động</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group-create">
                                    @Html.LabelFor(model => model.MOTA, "Mô tả sản phẩm", htmlAttributes: new { @class = "control-label-create" })
                                    <div class="form-input-create">
                                        @Html.TextAreaFor(model => model.MOTA, new { @class = "form-control-create", rows = "4" })
                                        @Html.ValidationMessageFor(model => model.MOTA, "", new { @class = "text-danger-create" })
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions-create mt-4">
                            <a href="@Url.Action("StatusShop")" class="btn-create btn-create-secondary">
                                <i class="fas fa-times"></i> Hủy bỏ
                            </a>
                            <button type="submit" class="btn-create btn-create-primary">
                                <i class="fas fa-save"></i> Lưu thay đổi
                            </button>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            // Hiệu ứng focus
            $('.form-control-create').focus(function () {
                $(this).css('border-color', '#0088FF');
            }).blur(function () {
                $(this).css('border-color', '#e9ecef');
            });

            // Form submit loading
            $('form').submit(function (e) {
                if ($(this).valid()) {
                    var submitBtn = $(this).find('.btn-create-primary');
                    var originalText = submitBtn.html();

                    submitBtn.html('<i class="fas fa-spinner fa-spin"></i> Đang lưu...');
                    submitBtn.prop('disabled', true);

                    // Simulate loading (remove in production)
                    setTimeout(function () {
                        submitBtn.html(originalText);
                        submitBtn.prop('disabled', false);
                    }, 1500);
                }
            });

            // Number input validation
            $('input[type="number"]').on('input', function () {
                var value = parseInt($(this).val());
                if (value < 0) {
                    $(this).val(0);
                }
            });
        });
    </script>
}